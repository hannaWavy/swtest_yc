<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no">
    <title>sw test</title>
    <link rel="manifest" href="./manifest.webmanifest">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="72x72" href="./images/manifest/icon-72x72.png">
    <link rel="icon" sizes="96x96" href="./images/manifest/icon-96x96.png">
    <link rel="icon" sizes="128x128" href="./images/manifest/icon-128x128.png">
    <link rel="icon" sizes="144x144" href="./images/manifest/icon-144x144.png">
    <link rel="icon" sizes="152x152" href="./images/manifest/icon-152x152.png">
    <link rel="apple-touch-icon" href="./images/manifest/icon-52x52.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./images/manifest/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./images/manifest/icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./images/manifest/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="./images/manifest/icon-167x167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./images/manifest/icon-180x180.png">
</head>
<body>
    <h1>this is the test page</h1>
    <button id="btnAdd">Add</button>
    <div id="messageBlock"></div>
</body>
<script>
    var deferredPrompt = false;

    messageBlock.textContent = "selector";

    if('serviceWorker' in navigator) {
        navigator.serviceWorker
            .register('./js/sw.js')
            .then(function() { console.log("Service Worker Registered"); });   
    }

    window.addEventListener('beforeinstallprompt', function(e) {
        deferredPrompt = e;
        messageBlock.textContent = "not installed";
    });

    window.addEventListener('appinstalled', function(e) { //if the app is on home screen
        messageBlock.textContent = "installed";
    });

    btnAdd.addEventListener('click', function(e) {
        if (deferredPrompt) {
            // hide our user interface that shows our A2HS button
            btnAdd.style.display = 'none';
            // Show the prompt
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    messageBlock.textContent = "User accepted the A2HS prompt";
                } else {
                    messageBlock.textContent = "User dismissed the A2HS prompt";
                }
                deferredPrompt = null;
            });
        } else {
            messageBlock.textContent = "no event beforeinstallprompt";
        }
    });
</script>
</html>